version: '3'

services:
  
  zookeeper:
    container_name: zookeeper
    build: zookeeper/

    ports:
      - 2185:2185
    volumes:
      - ./zookeeper/conf:/opt/zookeeper/conf
      - ./zookeeper/data:/tmp/zookeeper
  
  kafka:
    container_name: kafka
    build: kafka/

    depends_on:
      - zookeeper

    ports:
      - 9092:9092
    volumes:
      - ./kafka/conf:/opt/kafka/config
      - ./kafka/data:/tmp/kafka-logs

  registrar:
    container_name: registrar
    build: registrar/
    depends_on:
      - kafka
    ports:
      - 15643:8082
    environment:
      - KAFKA_HOST=kafka
      - KAFKA_PORT=9092
      - SERVICE_PORT=8082
      - KAFKA_TOPIC=changes
      - KAFKA_TOPIC_PARTITION=0
  
networks:
  default:
    external:
      name: kafka-network
  