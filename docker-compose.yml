version: '3'

services:
  
  zookeeper:
    container_name: zookeeper
    build: zookeeper/

    ports:
      - 2185:2185
    volumes:
      - ./zookeeper/conf:/opt/zookeeper/conf
      - ./zookeeper/data:/tmp/zookeeper
  
  kafka:
    container_name: kafka
    build: kafka/

    depends_on:
      - zookeeper

    ports:
      - 9092:9092
    volumes:
      - ./kafka/conf:/opt/kafka/config
      - ./kafka/data:/tmp/kafka-logs

  registrar-client:
    container_name: registrar-client
    build: registrar/
    depends_on:
      - kafka
    ports:
      - 15643:8082
    environment:
      - KAFKA_HOST=kafka
      - KAFKA_PORT=9092
      - KAFKA_TOPIC=changes
      - KAFKA_TOPIC_PARTITION=0
      - KAFKA_MESSAGE_KEY=client
      - SERVICE_PORT=8082
      - SERVICE_METHOD=client
      - SERVICE_CHECK_INPUT=1

  registrar-tocrm:
    container_name: registrar-crm
    build: registrar/
    depends_on:
      - kafka
    ports:
      - 15644:8082
    environment:
      - KAFKA_HOST=kafka
      - KAFKA_PORT=9092
      - KAFKA_TOPIC=tocrm
      - KAFKA_TOPIC_PARTITION=0
      - KAFKA_MESSAGE_KEY=client
      - SERVICE_PORT=8082
      - SERVICE_METHOD=to-crm
      - SERVICE_CHECK_INPUT=0 
           
networks:
  default:
    external:
      name: kafka-network
  